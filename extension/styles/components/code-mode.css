/* ==================== CODE-ONLY MODE (THEME AWARE) ==================== */

/* --- 1. THEME VARIABLES --- */
:root {
    /* User Message Styling (Light) */
    --code-user-bg: linear-gradient(135deg, rgba(142, 142, 160, 0.04) 0%, transparent 100%);
    --code-user-border: rgba(142, 142, 160, 0.3);

    /* Turn Indicator (Light) */
    --code-turn-bg: rgba(255, 255, 255, 0.8);
    --code-turn-border: var(--cf-color-border-base, rgba(0, 0, 0, 0.1));
    --code-turn-text: var(--cf-color-text-secondary, #6e6e80);

    /* AI Divider (Light) */
    --code-ai-border: var(--cf-color-border-light, rgba(0, 0, 0, 0.06));
}

/* Dark Mode Overrides (System Preference) */
@media (prefers-color-scheme: dark) {
    :root {
        --code-user-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
        --code-user-border: rgba(255, 255, 255, 0.15);
        --code-turn-bg: #2f2f2f;
        --code-turn-border: rgba(255, 255, 255, 0.15);
        --code-turn-text: #acacbe;
        --code-ai-border: rgba(255, 255, 255, 0.1);
    }
}

/* Dark Mode Overrides (Manual Class) */
html.dark {
    --code-user-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
    --code-user-border: rgba(255, 255, 255, 0.15);
    --code-turn-bg: #2f2f2f;
    --code-turn-border: rgba(255, 255, 255, 0.15);
    --code-turn-text: #acacbe;
    --code-ai-border: rgba(255, 255, 255, 0.1);
}

/* --- 2. LOGIC & STYLING --- */

/* Hide non-code in AI messages */
body.chat-focus-code-mode .chat-focus-ai-collapsed .markdown>*:not(pre):not(div[class*="code"]):not([class*="codeblock"]),
body.chat-focus-code-mode .chat-focus-ai-collapsed [class*="markdown"]>*:not(pre):not(div[class*="code"]):not([class*="codeblock"]) {
    display: none !important;
}

/* Ensure User message is fully visible */
body.chat-focus-code-mode .chat-focus-user-collapsed .markdown>*,
body.chat-focus-code-mode .chat-focus-user-collapsed [class*="markdown"]>* {
    display: block !important;
}

/* Spacing adjustment for code blocks */
body.chat-focus-code-mode .chat-focus-ai-collapsed pre,
body.chat-focus-code-mode .chat-focus-ai-collapsed div[class*="code"],
body.chat-focus-code-mode .chat-focus-ai-collapsed [class*="codeblock"] {
    margin-top: var(--cf-space-2xl, 32px) !important;
    margin-bottom: var(--cf-space-2xl, 32px) !important;
}

/* Remove top margin for the first code block */
body.chat-focus-code-mode .chat-focus-ai-collapsed .markdown pre:first-child,
body.chat-focus-code-mode .chat-focus-ai-collapsed [class*="markdown"] pre:first-child {
    margin-top: 0 !important;
}

/* User Styling (Context Box) */
body.chat-focus-code-mode .chat-focus-user-collapsed:not(.chat-focus-user-before-no-code) {
    padding: var(--cf-space-lg, 16px) var(--cf-space-xl, 24px) !important;
    margin-bottom: var(--cf-space-lg, 16px) !important;

    background: var(--code-user-bg);
    border-left: 3px solid var(--code-user-border);
    border-radius: var(--cf-radius-md, 8px);
    position: relative;
}

/* AI Code Group Styling */
body.chat-focus-code-mode .chat-focus-ai-collapsed:not(.chat-focus-no-code) {
    padding-bottom: var(--cf-space-3xl, 48px) !important;
    margin-bottom: var(--cf-space-3xl, 48px) !important;
    border-bottom: 2px solid var(--code-ai-border);
    position: relative;
}

/* Turn Indicators */
.chat-focus-turn-indicator {
    display: none;
}

body.chat-focus-code-mode .chat-focus-turn-indicator {
    display: inline-block;
    margin-bottom: var(--cf-space-md, 12px);
    font-size: 11px;
    font-weight: 600;

    color: var(--code-turn-text);
    background: var(--code-turn-bg);
    padding: 6px 12px;
    border-radius: 999px;
    border: 1.5px solid var(--code-turn-border);

    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* Hide non-code messages completely */
body.chat-focus-code-mode .chat-focus-processed.chat-focus-ai-collapsed.chat-focus-no-code {
    display: none !important;
}

body.chat-focus-code-mode .chat-focus-processed.chat-focus-user-collapsed.chat-focus-user-before-no-code {
    display: none !important;
}

/* Hide the regular folding labels/buttons in code mode */
body.chat-focus-code-mode .chat-focus-label,
body.chat-focus-code-mode .chat-focus-refold-btn {
    display: none !important;
}